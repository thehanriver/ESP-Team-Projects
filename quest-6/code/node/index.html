<!DOCTYPE html>
<html>
  <head>
	  <title>Quest 6</title>
  </head>
  <body>
  	<!-- <div id="div1">
      <button id="All"
  			  type="button"
  			  onClick=readAll()
  			  style=" height:50px; width:200px ">
    		All Candidates
    	</button>

    	<button  id="Cands"
          type="button"
  			  onClick=candVotes()
  			  style=" height:50px; width:200px ">
    	   Votes by Candidates
      </button>

      <button id="Clear"
  			  type="button"
  			  onClick=sendClear();
  			  style=" height:50px; width:200px ">
    		Clear Database
    	</button>
    </div> -->
    <div> <b>Log</b></div>

    <form id="myform" action="javascript:;" onsubmit="submitForm(this)">
      <label for="keyid">Key ID</label>
      <input type="text" name="keyid" id="keyid" required>
      
      <button type="submit" id="submit">Filter</button>
      <button type="reset" id="clear" onClick = clearFilter()>Clear</button>
    </form>
    <div id = 'log'></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>

      

      var logContents;
      var updateInterval = 1000;
      function updateLog() {
        $.ajax({url: "/log", success: function(result){
          logContents = "";
          var eventString;
          if (result==='hi')
          {
            console.log(result);
            return;
          }
          jQuery.each(result, function(i, val) {
            if (val.event===0){
              eventString = ' denied access';
            }
            else if (val.event===1){
              eventString = ' granted access ';
            }
            else if (val.event===2){
              eventString = ' changed password ';
            }
            logContents += "Key " + val.keyID.toString() + eventString + "at time " +val.dateTime + " <br />";

          });

          document.getElementById('log').innerHTML=logContents;
          
          
        }});
      }

      updateLog();
      setInterval(function(){updateLog()}, updateInterval);


      function submitForm() {
        document.getElementById('log').innerHTML = "";
        $.post('/query',{keyID: document.getElementById("keyid").value},function(data,status){
            console.log(status);
          });
      }

      // $('#submit').click(function() {
      //     $.ajax({
      //       url: '/query',
      //       type: 'POST',
      //       data: {
      //         keyID: document.getElementById("keyid").value
      //       },
      //       // success: function(msg) {
      //       //   alert('Email Sent');
      //       // }               
      //     });
      //   });
      function clearFilter() {
        document.getElementById('log').innerHTML = "";
        $.post('/query',{keyID: -1},function(data,status){
					console.log(status);
				});
      }
      
    </script>
  </body>
</html>
