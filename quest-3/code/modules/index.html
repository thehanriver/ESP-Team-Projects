<!DOCTYPE html>
<html>
  <head><title>Dynamic Sensor Data</title></head>
  <body>
  	<div id="div1"></div>
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  	
  	<script>window.onload = function () {


	var updateInterval = 1000;
	var dataLength = 25; // number of dataPoints visible at any point
	var last_time = "-1";
	var x_dps = [];
	var y_dps = [];
	var z_dps = [];
	var therm_dps = [];

	var chart1 = new CanvasJS.Chart("chartContainer1", {
			title :{
				text: "Dynamic Sensor Data"
			},
			axisX:  {
				title: "Time Since Flash (s)"
			},
			axisY: {
				title: "Temperature (°C)"
			},
			toolTip: {
				shared: true
			},
			legend: {
				cursor: "pointer",
				verticalAlign: "top",
				horizontalAlign: "center",
			},
			data: [{
				type:"line",
				name: "Thermistor",
				showInLegend: true,
				markerSize: 0,
				yValueFormatString: "#,###.00°C",
				dataPoints: therm_dps
			}, {

			}]
		});

		var chart2 = new CanvasJS.Chart("chartContainer2", {
			title :{
				text: "Dynamic Sensor Data"
			},
			axisX:  {
				title: "Time Since Flash (s)"
			},
			axisY: {
				title: "Acceleration (m/s^2)"
			},
			toolTip: {
				shared: true
			},
			legend: {
				cursor: "pointer",
				verticalAlign: "top",
				horizontalAlign: "center",
			},
			data: [{
				type:"line",
				name: "X Acceleration",
				showInLegend: true,
				markerSize: 0,
				yValueFormatString: "#,###.00",
				dataPoints: x_dps
			}, {
				type:"line",
				name: "Y Acceleration",
				showInLegend: true,
				markerSize: 0,
				yValueFormatString: "#,###.00",
				dataPoints: y_dps
			}, {
				type:"line",
				name: "Z Acceleration",
				showInLegend: true,
				markerSize: 0,
				yValueFormatString: "#,###.00",
				dataPoints: z_dps
			}]
		});


	// $.ajax({url: "/data", success: function(result){

	// 	jQuery.each(result, function(i, val) {

	// 		// fix
	// 		x_dps.push({ x: parseInt(val[0]), y: parseFloat(val[1]) });
	// 		y_dps.push({ x: parseInt(val[0]), y: parseFloat(val[2]) });
	// 		z_dps.push({ x: parseInt(val[0]), y: parseFloat(val[2]) });
	// 		therm_dps.push({ x: parseInt(val[0]), y: parseFloat(val[3]) });

	// 		if (x_dps.length > dataLength) {
	// 			x_dps.shift();
	// 			y_dps.shift();
	// 			z_dps.shift();
	// 			therm_dps.shift();
	// 		}

	// 	});

	// 	chart1.render();
	// 	chart2.render();
	// }});




	var updateChart = function (ultrasound_dp,ir_dp,therm_dp) {


		$.ajax({url: "/data/last", success: function(result){

			// jQuery.each(result, function(i, val) {

			// 	// fix
			// 	x_dps.push({ x: parseInt(val[0]), y: parseFloat(val[1]) });
			// 	y_dps.push({ x: parseInt(val[0]), y: parseFloat(val[2]) });
			// 	z_dps.push({ x: parseInt(val[0]), y: parseFloat(val[2]) });
			// 	therm_dps.push({ x: parseInt(val[0]), y: parseFloat(val[3]) });

			// 	if (x_dps.length > dataLength) {
			// 		x_dps.shift();
			// 		y_dps.shift();
			// 		z_dps.shift();
			// 		therm_dps.shift();
			// 	}

			// });

			// fix
			x_dps.push({ x: parseInt(result[0]), y: parseFloat(result[2]) });
			y_dps.push({ x: parseInt(result[0]), y: parseFloat(result[3]) });
			z_dps.push({ x: parseInt(result[0]), y: parseFloat(result[4]) });
			therm_dps.push({ x: parseInt(result[0]), y: parseFloat(result[1]) });

			if (x_dps.length > dataLength) {
				x_dps.shift();
				y_dps.shift();
				z_dps.shift();
				therm_dps.shift();
			}

		}});

		chart1.render();
		chart2.render();

	};

	updateChart();
	setInterval(function(){updateChart()}, updateInterval);

}</script>

  	<div id="chartContainer1" style="height: 300px; width: 100%;"></div>
  	<div id="chartContainer2" style="height: 300px; width: 100%;"></div>
  	<button id="OnOff"
			  type="button"
			  onClick="sendOnOff()"
			  style=" height:50px; width:200px ">
  		Turn On
  	</button>
  	<button type="button"
			  id="webCam"
			  onclick=" window.location.href='http://vivpi.ddns.net:3434/';"
			  style=" height:50px; width:200px " />
	<script type="text/javascript" src="index.js"></script>
	<script type="text/javascript">toggleLED();</script>
  	<script type="text/javascript">
	function sendOnOff() {
  		var name = document.getElementById("OnOff").innerText;
  		if(name === 'Turn On'){
  			document.getElementById("OnOff").innerText = 'Turn Off';
  			toggleLED();
  		}
  		else if(name === 'Turn Off'){
  			document.getElementById("OnOff").innerText = 'Turn On';
  			toggleLED();
  	}
  	}</script>
  	<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
  </body>
</html>
